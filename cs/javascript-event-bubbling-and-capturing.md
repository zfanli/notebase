---
created: 2022-01-16
type: JavaScript
tags: JavaScript
---

# 事件冒泡和捕获 Event Bubbling and Capturing

## 事件冒泡 Event Bubbling

事件冒泡的定义很简单：当一个元素上发生一个事件时，首先这个元素上注册的监听器会被执行，其次它的父元素、祖先元素的监听器会依次向上执行。

冒泡这个词形容在水中产生的一个气泡，会从产生的位置开始向上一直到浮出水面。事件冒泡也是相同的过程，一个元素上发生的事件，会从发生的位置开始向父代、祖代元素冒泡传递。事件对象上有两个属性用来指向事件发生的位置和当前处理事件的位置：

- `Event.target` 事件发生的位置（元素）
- `this` or `Event.currentTarget` 当前处理这个事件的元素

事件的传播过程可以使用 `e.stopPropagation()` 方法在任意时刻停止，阻止的是祖代元素的监听器执行。

还有另一个方法 `e.stopImmediatePropagation()`，与上面方法的区别在于，这个方法执行后，当前元素上绑定的其他监听器将不会被执行。所以其不仅阻止祖代元素的监听器执行，还阻止了当前元素的其他监听器的执行。

> 注意 ⚠️，阻止事件传播有时是一个隐藏陷阱，考虑下面的例子：
>
> 1. 一个嵌套菜单中，每个菜单选项都调用了 `stopPropagation` 方法防止外层菜单被触发
> 2. 后来我们在 window 对象上想追踪用户行为， 我们监听所有 click 事件来获得这些信息
> 3. 在第一步停止传播的那块区域在我们的分析系统中等于被隐藏起来了，形成了一个“死区”
>
> 通常我们都不需要阻止事件冒泡，有很多方法可以规避冒泡产生的影响，比如我们可以使用自定义事件。

## 事件捕获 Event Capturing

DOM Event 标准定义了事件传播的 3 个阶段：

1. 捕获阶段：事件从上至下直到抵达目标元素
2. 目标阶段：事件抵达了目标元素
3. 冒泡阶段：事件从目标元素向上冒泡

下面图片展示当 `<td>` 元素被点击时事件阶段的流程。

![event flow](../attachments/eventflow.svg)
