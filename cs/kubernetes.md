---
type: DevOps
---

# Kubernetes

简称 K8s，名字源自希腊语单词“掌舵者”，logo 是船舵。由谷歌在 2014 年提出，是一个自动部署、扩展和管理容器化应用的开源系统。

## K8s 可以做什么？

对于 modern web 服务来说：

- 用户期望服务 7 天 24 小时可用
- 开发者期望一天多次发布新版本

为了实现这个目标我们使用容器化技术，消除应用更新发布时的停机时间。K8s 帮助我们给容器化的应用提供资源和工具，确保应用在期望时机和位置运作。

K8s 是运用谷歌公司在容器编排方面积累的经验，结合社区的最佳创意设计出来用于生产环境的开源平台。

## K8s 集群

K8s Clusters，集群。

- K8s 协调一个高可用计算机集群，每台计算机作为一个独立单元相互连接工作
- K8s 抽象允许我们将容器化的应用部署到集群，而非将应用绑定到某台特定的机器上
- K8s 在集群中以更高效的方式自动分配和调度应用容器

K8s 集群由 2 种类型资源构成：

- 控制平面 Control Plane 负责协调集群（我们理解的 master 节点）
- 节点 Nodes 作为工作节点负责运行容器化应用

### 控制平面 Control Plane

控制平面负责管理集群，协调集群中的所有活动，如：

- 调度应用程序
- 维护应用状态
- 应用扩容
- 滚动更新

### 节点 Node

一个节点是一个 VM 或物理机，在 K8s 集群中作为一个工作机器的角色。每个节点上有：

- 一个 `kubelet` 负责管理节点和与控制平面通信
- 工具用来操作 containerd 或 Docker 容器

投入生产使用的 K8s 集群最少需要 3 个节点，每个节点一旦宕机，其对应的 etcd member 和控制平面实例都会丢失，对冗余产生影响。这个风险可以通过添加更多控制平面节点来缓解。

当你在 k8s 上部署一个应用时：

- 你通知控制平面启动这个应用容器
- 控制平面调度容器在集群的节点上运行

节点通过控制平面暴露的 k8s API 与其通信，你也可以直接和集群的 API 交互。

## Deployment

K8s 的 Deployment 是一种声明式的配置，用来告诉 k8s 如何创建和更新应用实例。Deployment 一旦创建，k8s 控制平面会调度 Deployment 定义的应用实例在集群中的独立节点中运行。

应用实例一旦被创建出来，k8s Deployment 控制器将持续监控这些实例：

- 如果一个实例挂了或者被删了，Deployment 控制器会在集群的其他节点启动一个新的实例取代它
- 这提供了一个自愈机制来应对机器错误或者维护

在编排系统出现以前，安装脚本只会用来启动应用，而不会实现从机器错误中恢复应用。K8s Deployment 通过创建实例，并维护实例在节点中的运行状态，提供一种不同的方式来做应用管理。
