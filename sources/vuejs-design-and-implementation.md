---
type: Book
tags: Frontend Vuejs Book
---

# Vue.js 设计与实现（霍春阳）

| Key  | Value             |
| ---- | ----------------- |
| 书名 | Vue.js 设计与实现 |
| 作者 | 霍春阳            |
| 字数 | 720k              |
| 时间 | 2022 年 1 月      |

## 1. 框架设计概览

结论：Vue.js 内部使用命令式代码实现了一个面向用户的声明式框架，但是执行效率上一定是命令式代码性能更优。声明式的代码执行时，性能消耗为解析具体需要执行的命令式代码，和执行具体命令式代码之和。

性能上声明式代码需要消耗比命令式代码更多的资源。但是相对命令式代码需要实现整个完整的过程而言，声明式代码只关注结果，可以写出更简单和好维护的代码。

Vue.js 为最优化声明式代码的执行效率，需要最小化解析并找到具体需要执行什么命令式代码这个过程的消耗。Vue.js 的方案是虚拟 DOM。

## Memo

声明式 VS 命令式

- 声明式简洁易维护，但是性能稍差
- 命令式性能好，但是心智负担重
- 虚拟 DOM 帮助最小化性能差距

运行时 VS 编译时 VS 运行时 + 编译时（？？只影响是否能在浏览器编译吧）

- Vue.js 是运行时 + 编译时
- 运行时没有编译行为
- 编译时将模版编译后交由运行时执行
- 运行时 + 编译时，运行时动态调用编译行为

响应式实现 - 基本

- 基于 ES6 的 Proxy
- 使用 WeakMap 收集依赖、建立字段映射关系并且不影响 GC

响应式实现 - 条件控制

- 条件控制会导致遗留副作用
  - 条件为 false 时不需要的依赖关系未被删除
  - 不需要的依赖被更新时执行了副作用函数
- 通过每次执行副作用时删除之前的依赖解决这个问题
  - 需要用一个属性记录所有副作用挂载的地方
  - 每次执行副作用时删除依赖关系
  - 每次执行副作用时重新创建依赖关系
  - 执行副作用时要避免操作同一个对象导致无限循环
    - 通过对遍历对象做一次备份避免无限循环
    - Set.prototype.forEach 规范
